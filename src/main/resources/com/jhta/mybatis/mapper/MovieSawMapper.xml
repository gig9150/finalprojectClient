<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jhta.mybatis.mapper.moviesaw">
	<select id="moviesawList" resultType="moviesaw" parameterType="int">
		select pp.movieimgurl, pp.filmname, pp.filmnum, pp.mstarttime, pp.theathername, pp.brname
		       ,nvl((select mreview.rcontent from mreview where pp.filmnum=mreview.filmnum and pp.booknum=mreview.booknum and memnum=mreview.memnum),'관람평을 작성해보세요.') mreview
		from (select m.memnum memnum, f.filmnum filmnum, b.booknum booknum, mo.movieimgurl movieimgurl, f.filmname filmname, ms.mstarttime mstarttime,t.theathername theathername, br.brname brname
		from membership m, charge c, book b, mschedule ms, theather t , branch br , purchasefilm p, film f, movieimg mo, mreview mr
		where m.memnum=c.memnum and c.chargenum=b.chargenum and b.mschedulenum=ms.mschedulenum and t.theathernum=ms.theathernum and
		t.branchnum=br.branchnum and p.purchasefilmnum=ms.purchasefilmnum and p.filenum=f.filmnum and f.filmnum=mo.filmnum and
		m.memnum=${memNum}) pp
	</select>
	<select id="movieCount" resultType="int">
		select count(*) from(
		    select pp.movieimgurl, pp.filmname, pp.filmnum, pp.mstarttime, pp.theathername, pp.brname
		       ,nvl((select mreview.rcontent from mreview where pp.filmnum=mreview.filmnum and pp.booknum=mreview.booknum and memnum=mreview.memnum),'관람평을 작성해보세요.') mreview
		    from (select m.memnum memnum, f.filmnum filmnum, b.booknum booknum, mo.movieimgurl movieimgurl, f.filmname filmname, ms.mstarttime mstarttime,t.theathername theathername, br.brname brname
		    from membership m, charge c, book b, mschedule ms, theather t , branch br , purchasefilm p, film f, movieimg mo, mreview mr
		    where m.memnum=c.memnum and c.chargenum=b.chargenum and b.mschedulenum=ms.mschedulenum and t.theathernum=ms.theathernum and
		    t.branchnum=br.branchnum and p.purchasefilmnum=ms.purchasefilmnum and p.filenum=f.filmnum and f.filmnum=mo.filmnum and
		    m.memnum=122) pp
		)
	</select>
</mapper>